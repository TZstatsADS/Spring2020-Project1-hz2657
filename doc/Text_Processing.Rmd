---
title: 'Tell the difference: Pop or Country, Hiphop or R&B'
author: "Huizhe (Sunny) ZHU"
output:
  html_notebook: default
  html_document:
    df_print: paged
  pdf_document: default
---

People on internet are arguing about the difference between Country music and Pop music. Pop represents 'popular', while country music is also popular in many regions including the US, and that makes it difficult to distuinguish the two genres. Meanwhile, Rhythm & Blues (R&B) is considered as a mix of Pop, Hip-Hop etc, thus it is also difficult to distinguish Hiphop or R&B. 

Given the 'lyrics' database that contains more than 120,000 songs, we have the chance to identify the differences among these genres by real examples. 


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



```{r load libraries, message=FALSE, warning=FALSE, include = FALSE}
#### Step 0 - Install packages & Load libraries
install.packages('broom')
install.packages('hrbrthemes')
install.packages('viridis')

library(tm)
library(data.table)
library(tidytext)
library(tidyverse)
library(DT)
library(hrbrthemes)
library(viridis)
```


```{r, include = FALSE}
#### Step 1 - Load the data
library(readr)
raw_lyrics <- read.csv("lyrics.csv", stringsAsFactors = FALSE)
```


```{r text processing in tm, include = FALSE}
#### Step 2 - Preliminary cleaning of text
#Convert letters to the lower case, remove punctuation, numbers, empty words and extra white space.

leadingWhitespace <- content_transformer(function(x) str_trim(x, side = "both"))

# remove stop words
data("stop_words")
word <- c("lot", "today", "months", "month", "wanna", "wouldnt", "wasnt", "ha", "na", "ooh", "da",
        "gonna", "im", "dont", "aint", "wont", "yeah", "la", "oi", "nigga", "fuck",
          "hey", "year", "years", "last", "past", "feel")
stop_words <- c(stop_words$word, word)

```


```{r,include = FALSE}
# clean the data and make a corpus
corpus <- VCorpus(VectorSource(raw_lyrics$lyrics))%>%
  tm_map(content_transformer(tolower))%>%
  tm_map(removePunctuation)%>%
  tm_map(removeWords, character(0))%>%
  tm_map(removeWords, stop_words)%>%
  tm_map(removeNumbers)%>%
  tm_map(stripWhitespace)%>%
  tm_map(leadingWhitespace)
```


```{r stemming, include = FALSE}
#### Step 3 - Stemming and converting to tidy object
#Stemming reduces a word to its word *stem*. Each row contains 1 song - its stemmed words - Note: 11 empty lines 
stemmed <- tm_map(corpus, stemDocument) %>%
  tidy() %>%
  select(text)
```


```{r tidy dictionary,include = FALSE}
#### Step 4 - Tokenization on original words, *9.51* million rows (words) in total, one column
dict <- tidy(corpus) %>%
  select(text) %>%
  unnest_tokens(dictionary, text)
```


```{r tidy stems with dictionary,include = FALSE}
#### Step 5 - Tokenization on stemmed words  -  Add ID = row_number, dict = original word, 9.51 million rows, 3 columns
completed <- stemmed %>%
  mutate(id = row_number()) %>%
  unnest_tokens(stems, text) %>%
  bind_cols(dict) 
```



```{r stem completion, warning=FALSE, message=FALSE,include = FALSE}
#### Step 6 - Stem completion
#Picking the original word (from the same root) with the highest frequency. The new column created -  'word' - will be used to replace stem, which is sometimes hard for people to understand. 
completed1 <- completed %>%
  group_by(stems) %>%
  count(dictionary) %>%
  mutate(word = dictionary[which.max(n)]) %>%
  ungroup() %>%
  select(stems, word) %>%
  distinct() %>%
  right_join(completed) %>%
  select(-stems)
```


```{r reverse unnest, message=FALSE,include = FALSE}
#### Step 7 - Pasting stem completed individual words into their respective lyrics
#Put 'word' generated from Step 6, back to each song row - each row contains words like before - but the words are transforme, from -> stemmed -> completed stem
completed2 <- completed1 %>%
  group_by(id) %>%
  summarise(stemmedwords= str_c(word, collapse = " ")) %>%
  ungroup()
```


```{r cleaned hm_data, warning=FALSE, message=FALSE,include = FALSE}
#### Step 8 - Keeping a track of the processed lyrics with their own ID
raw_lyrics1 <- raw_lyrics %>%
  mutate(id = row_number()) %>%
  inner_join(completed2)
```


```{r export data,message=FALSE,include = FALSE}
#### Step 9 - Exporting the processed text data into a CSV file
save(raw_lyrics1, file="../output/processed_lyrics3.RData")
```



In the lyrics dataset, there are 7534 Country songs, 18697 Pop songs,  8905 Hip-Hops, and 2174 R&B. 

```{r,include = FALSE}
#### Step 1 - Create sub-dataset
table(raw_lyrics1$genre)
```


```{r,include = FALSE}
# subset the corresponding genres
country = raw_lyrics1[raw_lyrics1$genre == 'Country',]
pop = raw_lyrics1[raw_lyrics1$genre == 'Pop',]
hiphop = raw_lyrics1[raw_lyrics1$genre == 'Hip-Hop',]
RB = raw_lyrics1[raw_lyrics1$genre == 'R&B',]
```



#### 1. Compare lyrics length

According to the boxplot, we can find out: 
Hip-Hop tends to be longer than R&B.
Pop tends to be longer than country songs. 

```{r,echo=FALSE, message=FALSE, warning=FALSE}
library(dplyr)
library(ngram)
total_four_songs = bind_rows(pop,country,hiphop,RB)

library(stringr)
total_four_songs$word_count <- str_count(total_four_songs$lyrics, '\\s+')+1

# remove outliers - remove rows 
total_four_songs <- na.omit(total_four_songs)
total_four_songs <- total_four_songs[-c(29439,29442,33045,28849),]

```

```{r,echo=FALSE, message=FALSE, warning=FALSE}
boxplot(word_count~genre,data=total_four_songs, main = "Lyrics Length between Country & Pop",col=(c("pink","light blue")),alpha=0.8,
   xlab="Genre", ylab="lyrics Length")

```

```{r}
# Dummy data
a <- seq(129,1)+4*runif(129,0.4)
b <- seq(1,129)^2+runif(129,0.98)
 
# Set the layout
nf <- layout(
  matrix(c(1,1,2,3), ncol=2, byrow=TRUE), 
  widths=c(3,1), 
  heights=c(2,2)
)
#Add the plots
total_four_songs %>%
  ggplot(aes(x=genre, y=word_count, fill=genre),col=(c("pink","light blue"))) +
    geom_boxplot() +
    scale_fill_viridis(discrete = TRUE, alpha=0.6, option="A") +
    theme_ipsum() +
    theme(
      legend.position="none",
      plot.title = element_text(size=11)
    ) +
    ggtitle("Boxplot - Lyrics Length Comparison") +
    xlab("Genre")

```



```{r,echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(hrbrthemes)
library(viridis)

total_four_songs %>%
  ggplot(aes(x=genre, y=word_count, fill=genre)) +
    geom_violin() +
    scale_fill_viridis(discrete = TRUE, alpha=0.6, option="A") +
    theme_ipsum() +
    theme(
      legend.position="none",
      plot.title = element_text(size=11)
    ) +
    ggtitle("Violin chart - Lyrics Length between Country & Pop") +
    xlab("Genre")


```





#### 2. Compare high-frequency words

Next, let's analyze their corresponding high frequency words and use it to define its topics

Pop and country are simiar. 
If try to make Love, baby .. etc. as new stop words, see what's left .. 

#### 3.1 Pop
```{r}
tidy_pop <- unnest_tokens(pop, output = 'word', token = 'words', input = stemmedwords)%>%
  count(word,sort = TRUE)

# barplot
barplot(tidy_pop[1:10,]$n, las = 2, names.arg = tidy_pop[1:10,]$word,
        col ="pink", main ="Pop - Most frequent words",
        ylab = "Word frequencies")
```

```{r}
# word cloud for pop
install.packages('wordcloud')
library(wordcloud)
tidy_pop_try <- unnest_tokens(pop, output='word',token='words',input = stemmedwords) 

# Converting the text file into a Corpus
corpus_pop <- VCorpus(VectorSource(tidy_pop_try$word))

wordcloud (corpus_pop, scale=c(5,0.5), max.words=100, random.order=FALSE, 
           rot.per=0.35, use.r.layout=FALSE, colors=brewer.pal(8, 'Dark2'))
```



#### 3.2 Country
```{r}
tidy_country <- unnest_tokens(country, output = 'word', token = 'words', input = stemmedwords)%>%
  count(word,sort = TRUE)

# barplot
barplot(tidy_country[1:10,]$n, las = 2, names.arg = tidy_country[1:10,]$word,
        col ="light blue", main ="Country - Most frequent words",
        ylab = "Word frequencies")
```

#### 3.3 HipHops

```{r}
tidy_hiphop <- unnest_tokens(hiphop, output = 'word', token = 'words', input = stemmedwords)%>%
  count(word,sort = TRUE)

# barplot
barplot(tidy_hiphop[1:10,]$n, las = 2, names.arg = tidy_hiphop[1:10,]$word,
        col ="orange", main ="Hiphop - Most frequent words",
        ylab = "Word frequencies")

```


#### 3.4 R&B
```{r}
tidy_RB <- unnest_tokens(RB, output = 'word', token = 'words', input = stemmedwords)%>%
  count(word,sort = TRUE)

# barplot
barplot(tidy_RB[1:10,]$n, las = 2, names.arg = tidy_RB[1:10,]$word,
        col ="black", main ="R&B - Most frequent words",
        ylab = "Word frequencies")
```








### Step 4 - Compare their emotions

Now let's check on the sentiment!

Compare the sentiment score for these 4 different types of songs. 

Hip hop and R&B are more similar, tend to haev stronger emotion variations. Hip-hop tends to have more negative words that R&B. 

Country and Pop are more similar. Their emotions are more gentle, and they both contains balanced emotions. 


```{r}
positive <- get_sentiments("bing") %>%
  filter(sentiment == "positive")

negative <- get_sentiments("bing") %>%
  filter(sentiment == "negative")
```

The top 10 positive words in Pop songs include: 
```{r}
tidy_pop %>%
  semi_join(positive) 
```
The top 10 positive words in Pop songs include: 
```{r}
library(dplyr)
tidy_pop_negative <- tidy_pop%>%
  semi_join(negative) 
head(tidy_pop_negative,10)
```

we count up how many positive and negative words there are in each genre. Letâ€™s find a sentiment score for each word  -- compare setiment along different genres

Referece:https://www.tidytextmining.com/sentiment.html from *Text mining with R*

# sentiment for each genre 


# Combine the first 400 songs of each genre

```{r}
pop_400 = pop[1:400,]
country_400 = country[1:400,]
hiphop_400 = hiphop[1:400,]
RB_400 = RB[1:400,]

total_400 = bind_rows(pop_400,country_400,hiphop_400,RB_400)

tidy_total_400 <- unnest_tokens(total_400, output = 'word', token = 'words', input = stemmedwords)

```


From the diagram, we can see, Hip-hop and R&B tend to have stronger emotions, while country and pop are more gentle.

```{r}
library(tidyr)
bing <- get_sentiments("bing")

songs_sentiment_try <- tidy_total_400 %>%
  inner_join(bing) %>%
  count(genre,song,sentiment) %>%
  spread(sentiment, n, fill = 0) %>%
  mutate(sentiment = positive - negative)

ggplot(data = songs_sentiment_try, aes(x=song,y=sentiment, fill=genre,color=genre))+
  geom_bar(stat = "identity", show.legend = FALSE) +
  facet_wrap(~genre, ncol = 2, scales = "free_x")

```


# Summary 

Lyrics length:

Frequent words:

Emotion variation:


### References
Quora (2019) https://www.quora.com/How-do-you-differentiate-between-a-country-song-and-a-pop-song-just-by-listening-to-it


























